(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Forum/Forum"],{"19a7":function(e,t,n){"use strict";n.r(t);var a=n("601b"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},"4b09":function(e,t,n){"use strict";n.r(t);var a=n("948f"),o=n("19a7");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("d822");var c,r=n("f0c5"),l=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"569b4fc4",null,!1,a["a"],c);t["default"]=l.exports},"601b":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("a34a"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,a,o,i,c){try{var r=e[i](c),l=r.value}catch(s){return void n(s)}r.done?t(l):Promise.resolve(l).then(a,o)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var c=e.apply(t,n);function r(e){i(c,a,o,r,l,"next",e)}function l(e){i(c,a,o,r,l,"throw",e)}r(void 0)}))}}var r,l=wx.cloud.database(),s=l.collection("forum"),u={data:function(){return{load:!0,startNum:0,activeTab:0,cardList:[],loadMoreStatus:1,fabList:[{bgColor:"#16C2C2",text:"发布",fontSize:28,color:"#fff"}],alldata:[]}},onShow:function(){this.load=!0,this.alldata=[],r=this,console.log("open",""==e.getStorageSync("openid")),void 0==e.getStorageSync("openid")||""==e.getStorageSync("openid")?(this.load=!1,this.$refs["toast"].open({message:"请先到 ‘我的’ 页面进行登陆",position:"middle"})):r.getdata()},onLoad:function(){},onReachBottom:function(){r.startNum++},methods:{changelike:function(t){return c(a.default.mark((function n(){var o,i,c,r,u;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log(t),n.next=3,l.collection("user").where({_openid:e.getStorageSync("openid")}).get();case 3:if(o=n.sent,i=o.data[0].likeforum,0!=t.islike){n.next=19;break}return i.push(t.id),l.collection("user").where({_openid:e.getStorageSync("openid")}).update({data:{likeforum:i},success:function(e){console.log(e)}}),n.next=10,s.doc(t.id).get();case 10:c=n.sent,c.data.like=t.likeforum,r=c.data.likes,console.log(r),r.push(e.getStorageSync("openid")),s.doc(t.id).update({data:{like:t.likenum+1,likes:r},success:function(e){console.log(e)}}),console.log("item",c),n.next=23;break;case 19:for(u=0;u<i.length;u++)t.id==i[u]&&i.splice(u,1);console.log(i),l.collection("user").where({_openid:e.getStorageSync("openid")}).update({data:{likeforum:i},success:function(e){console.log(e)}}),s.doc(t.id).update({data:{like:t.likenum-1},success:function(e){console.log(e)}});case 23:case"end":return n.stop()}}),n)})))()},getdata:function(){var t=this;return c(a.default.mark((function n(){var o,i,c,r,u,d,f,m,g;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,s.orderBy("date","desc").get({});case 2:o=n.sent,console.log("a",o),i=0;case 5:if(!(i<o.data.length)){n.next=46;break}c={},c.id=o.data[i]._id,c.title=o.data[i].content,c.likeNum=o.data[i].like,r=[],u=0;case 12:if(!(u<o.data[i].imgList.length)){n.next=20;break}return n.next=15,wx.cloud.downloadFile({fileID:o.data[i].imgList[u]});case 15:d=n.sent,r.push({url:d.tempFilePath});case 17:u++,n.next=12;break;case 20:return c.imgList=r,c.createTime="".concat(o.data[i].date.getMonth()+1,"-").concat(o.data[i].date.getDate()),console.log("commit",o.data[i].comment),c.commentNum=o.data[i].comment.length,n.next=26,l.collection("user").where({_openid:o.data[i]._openid}).get();case 26:return f=n.sent,c.avatarUrl=f.data[0].avatarUrl,c.nickName=f.data[0].name,n.next=31,l.collection("user").where({_openid:e.getStorageSync("openid")}).get();case 31:m=n.sent,g=0;case 33:if(!(g<m.data[0].likeforum.length)){n.next=40;break}if(m.data[0].likeforum!=o.data[i]._id){n.next=37;break}return c.isLike=!0,n.abrupt("break",40);case 37:g++,n.next=33;break;case 40:void 0==c.isLike&&(c.isLike=!1),console.log(c.isLike),t.alldata.push(c);case 43:i++,n.next=5;break;case 46:console.log(t.alldata),t.load=!1,console.log(t.load);case 49:case"end":return n.stop()}}),n)})))()},toDetails:function(t){e.navigateTo({url:"../diary/details/details?id="+t})},loadData:function(e){if("add"===e){var t=r.cardList;8==t.length?r.loadMoreStatus=2:t.length>0?r.cardList=r.cardList.concat({id:2,time:"06-17",avatarUrl:"https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=146873609,3496106191&fm=26&gp=0.jpg",nickName:"小黄鸭",title:"洛稚喜欢盛淮南谁也不知道",follow:!1,isLike:!1,likeNum:"24",commentNum:"0",imgList:[{url:"https://6d61-matchbox-79a395-1302390714.tcb.qcloud.la/matchbox/1e942ff08083714184afbf42eba0d87.jpg"}]}):r.cardList=r.$store.state.diary.cardList}else r.$refs.mixPulldownRefresh&&r.$refs.mixPulldownRefresh.endPulldownRefresh()},onPulldownReresh:function(){r.loadData("refresh")},handleTab:function(e){r.activeTab=e},handleFab:function(t){var n=t.index;switch(n){case 0:e.navigateTo({url:"../push/push"});break;case 1:console.log(1);break}}}};t.default=u}).call(this,n("543d")["default"])},"68b1":function(e,t,n){},"948f":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var a={yRefresh:function(){return n.e("components/y-Refresh/y-Refresh").then(n.bind(null,"6152"))},yDiaryItem:function(){return n.e("components/y-DiaryItem/y-DiaryItem").then(n.bind(null,"8993"))},yFab:function(){return n.e("components/y-Fab/y-Fab").then(n.bind(null,"017a"))},clToast:function(){return Promise.all([n.e("common/vendor"),n.e("cl-uni/components/cl-toast/cl-toast")]).then(n.bind(null,"e69c"))},clLoadingMask:function(){return n.e("cl-uni/components/cl-loading-mask/cl-loading-mask").then(n.bind(null,"f1a3"))}},o=function(){var e=this,t=e.$createElement;e._self._c},i=[]},c9cd:function(e,t,n){"use strict";(function(e){n("8df7");a(n("66fd"));var t=a(n("4b09"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},d822:function(e,t,n){"use strict";var a=n("68b1"),o=n.n(a);o.a}},[["c9cd","common/runtime","common/vendor"]]]);